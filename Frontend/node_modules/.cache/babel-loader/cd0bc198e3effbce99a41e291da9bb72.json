{"ast":null,"code":"var _jsxFileName = \"/Users/jonathantaylor/Google Drive/Interview2/Frontend/src/containers/LoansAndData.js\";\nimport React, { useEffect, useState, useContext } from 'react';\nimport axios from 'axios';\nimport { loanTypeContext, companyLoanContext } from '../context';\nimport Company from '../components/company';\nimport InputAndError from '../components/inputAndError';\nimport SelectAndError from '../components/selectAndError';\nimport LoanRequest from '../components/loanInfo';\nimport styled from 'styled-components';\nimport { Redirect, useHistory } from 'react-router-dom';\nimport { average, tags, loanAmounts, bandCounter2, loanBandCounter, frequencyAndTotal } from '../calculationFunctions';\nimport Chart from \"react-apexcharts\";\nconst StyledUl = styled.ul`\ndisplay: flex;\nflex-direction: column;\nwidth: 400px;\nmargin-top: 5rem;\n`;\nconst StyledChart = styled(Chart)`\nborder: black solid 1px;\nmargin: 4rem;\nwidth: 700px;\n`;\n\nconst LoansAndData = props => {\n  const [companies, setCompanies] = useState([]);\n  const startFormData = {\n    name: \"\",\n    amount: \"\",\n    type: \"DEFAULT\",\n    otherType: \"\"\n  };\n  const {\n    loanTypes\n  } = useContext(loanTypeContext);\n  const [loanData, setLoanData] = useState(startFormData);\n  const {\n    companyLoanDetails,\n    setCompanyLoanDetails\n  } = useContext(companyLoanContext);\n  const [inputValidated, setInputValidated] = useState({\n    name: false,\n    amount: false,\n    type: false,\n    otherType: true\n  });\n  const [inputClicked, setInputClicked] = useState({\n    name: false,\n    amount: false,\n    type: false,\n    otherType: false\n  });\n  const [data, setData] = useState();\n  const [chartConfig, setChartConfig] = useState();\n  const history = useHistory();\n  useEffect(() => {\n    getCompanies();\n  }, []);\n\n  const getCompanies = async () => {\n    let response = await axios.get('http://localhost:5000/loans');\n    setCompanies(response.data.companies);\n    let response2 = frequencyAndTotal(loanTypes, response.data.companies);\n    let dataTypes = Object.keys(response2);\n    let frequencyAndTotals = Object.values(response2);\n    let averages = frequencyAndTotals.map(data => data.frequency !== 0 ? data.totalAmount / data.frequency : 0);\n    let typeFrequencies = frequencyAndTotals.map(data => data.frequency);\n    setData({\n      averages: averages,\n      frequencies: typeFrequencies\n    });\n    setChartConfig({\n      options: {\n        plotOptions: {\n          bar: {\n            distributed: true\n          }\n        },\n        legend: {\n          show: false\n        },\n        chart: {\n          id: \"basic-bar\"\n        },\n        xaxis: {\n          categories: [dataTypes],\n          labels: {\n            trim: false,\n            maxHeight: 180\n          }\n        }\n      },\n      series: [{\n        name: \"\",\n        data: [averages]\n      }]\n    });\n  };\n\n  const addLoan = async e => {\n    e.preventDefault();\n    let data = {\n      name: loanData.name,\n      amount: loanData.amount,\n      type: loanData.type,\n      otherType: loanData.otherType\n    };\n    await axios.post('http://localhost:5000/loans', data);\n    setLoanData(startFormData);\n    getCompanies();\n  };\n\n  const dropDownChangeHandler = e => {\n    let {\n      value\n    } = e.target;\n\n    if (value === \"Other\") {\n      setLoanData({ ...loanData,\n        type: value\n      });\n      setInputValidated({ ...inputValidated,\n        otherType: false\n      });\n    } else {\n      setLoanData({ ...loanData,\n        type: value,\n        otherType: \"\"\n      });\n      setInputValidated({ ...inputValidated,\n        otherType: true\n      });\n    }\n  };\n\n  const onChangeHandler = e => {\n    let {\n      name,\n      value\n    } = e.target;\n    setLoanData({ ...loanData,\n      [name]: value\n    });\n  };\n\n  const showLoanDetails = companyId => {\n    let clickedCompany = companies.find(company => company._id === companyId);\n    setCompanyLoanDetails(clickedCompany);\n    history.push('/details');\n  };\n\n  const deleteCompany = async companyId => {\n    await axios.delete('http://localhost:5000/loans/' + companyId);\n    let updatedCompanies = [...companies].filter(company => company._id !== companyId);\n    setCompanies(updatedCompanies);\n  };\n\n  const inputUsed = name => {\n    if (inputClicked[name] === false) {\n      setInputClicked({ ...inputClicked,\n        [name]: true\n      });\n    }\n  };\n\n  const onBlurHandler = e => {\n    let {\n      name,\n      value\n    } = e.target;\n    inputUsed(name);\n    isFieldValid(name, value);\n  };\n\n  const isFieldValid = (name, value) => {\n    let validator = true;\n\n    if (value === \"\") {\n      validator = \"Please insert a value\";\n      setInputValidated({ ...inputValidated,\n        [name]: validator\n      });\n      return;\n    }\n\n    switch (name) {\n      case \"type\":\n        if (value === \"DEFAULT\") {\n          validator = \"Please choose a type\";\n        }\n\n        break;\n\n      case \"amount\":\n        console.log(name);\n\n        if (value < 15000) {\n          validator = \"Please insert an amount greater than £15000\";\n        } else if (value % 1000 !== 0) {\n          validator = \"Please insert an amount that is a multiple of 1000\";\n        }\n\n        break;\n    }\n\n    setInputValidated({ ...inputValidated,\n      [name]: validator\n    });\n  };\n\n  let formValid = () => {\n    for (let key in inputValidated) {\n      if (inputValidated[key] !== true) {\n        return false;\n      }\n    }\n\n    return true;\n  };\n\n  const changeGraph = e => {\n    let updatedConfig = { ...chartConfig\n    };\n\n    switch (e.target.name) {\n      case \"average\":\n        setChartConfig({ ...chartConfig,\n          series: [{\n            name: \"Average\",\n            data: data.averages\n          }]\n        });\n        break;\n\n      case \"frequencyType\":\n        setChartConfig({ ...chartConfig,\n          series: [{\n            name: \"Frequency\",\n            data: data.frequencies\n          }]\n        });\n        break;\n\n      default:\n        console.log(\"error\");\n    }\n  };\n\n  let companiesUI;\n\n  if (companies !== []) {\n    companiesUI = companies.map(company => {\n      return /*#__PURE__*/React.createElement(Company, {\n        showLoanDetails: () => showLoanDetails(company._id),\n        key: company._id,\n        name: company.name,\n        deleteCompany: () => deleteCompany(company._id),\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 20\n        }\n      }, company.loans.map(loan => /*#__PURE__*/React.createElement(LoanRequest, {\n        amount: loan.amount,\n        type: loan.type,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 192,\n          columnNumber: 45\n        }\n      })));\n    });\n  }\n\n  const optionElements = [/*#__PURE__*/React.createElement(\"option\", {\n    key: \"-1\",\n    value: \"DEFAULT\",\n    disabled: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 29\n    }\n  }, \"Loan Type\"), loanTypes.map((loanType, index) => /*#__PURE__*/React.createElement(\"option\", {\n    key: index,\n    value: loanType,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 124\n    }\n  }, loanType))];\n  console.log(chartConfig);\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"form\", {\n    onSubmit: e => addLoan(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(InputAndError, {\n    id: \"nameInput\",\n    label: \"Name\",\n    name: \"name\",\n    value: loanData.name,\n    onChange: e => onChangeHandler(e),\n    onBlur: e => onBlurHandler(e),\n    errorMessage: inputValidated.name,\n    inputClicked: inputClicked.name,\n    inputValidated: inputValidated.name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 203,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(InputAndError, {\n    id: \"amountInput\",\n    label: \"Amount\",\n    name: \"amount\",\n    value: loanData.amount,\n    onChange: e => onChangeHandler(e),\n    onBlur: e => onBlurHandler(e),\n    errorMessage: inputValidated.amount,\n    inputClicked: inputClicked.amount,\n    inputValidated: inputValidated.amount,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 204,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(SelectAndError, {\n    id: \"loanType\",\n    label: \"Type\",\n    onBlur: e => onBlurHandler(e),\n    required: true,\n    name: \"type\",\n    value: loanData.type,\n    onChange: e => dropDownChangeHandler(e),\n    errorMessage: inputValidated.type,\n    inputClicked: inputClicked.type,\n    inputValidated: inputValidated.type,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 13\n    }\n  }, optionElements), loanData.type === \"Other\" ? /*#__PURE__*/React.createElement(InputAndError, {\n    id: \"otherType\",\n    label: \"Other Type\",\n    name: \"otherType\",\n    value: loanData.otherType,\n    onChange: e => onChangeHandler(e),\n    onBlur: e => onBlurHandler(e),\n    errorMessage: inputValidated.otherType,\n    inputClicked: inputClicked.otherType,\n    inputValidated: inputValidated.otherType,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 13\n    }\n  }) : null, /*#__PURE__*/React.createElement(\"button\", {\n    disabled: !formValid(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 13\n    }\n  }, \"Add Loan Request\")), /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"h1\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 13\n    }\n  }, \"Businesses\"), companies !== [] ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 218,\n      columnNumber: 13\n    }\n  }, \"Click Business to Show Further Details\"), /*#__PURE__*/React.createElement(StyledUl, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 219,\n      columnNumber: 13\n    }\n  }, companiesUI)) : /*#__PURE__*/React.createElement(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221,\n      columnNumber: 16\n    }\n  }, \"Currently no businesses\")), chartConfig.options.xaxis.categories.length !== 0 ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 225,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(\"button\", {\n    name: \"average\",\n    onClick: e => changeGraph(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 226,\n      columnNumber: 21\n    }\n  }, \"Average of Each Loan Type\"), /*#__PURE__*/React.createElement(\"button\", {\n    name: \"frequencyType\",\n    onClick: e => changeGraph(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 227,\n      columnNumber: 21\n    }\n  }, \"Frequency of Each Loan Type\"), /*#__PURE__*/React.createElement(\"button\", {\n    name: \"frequencyBands\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 228,\n      columnNumber: 21\n    }\n  }, \"Frequency of Loans in Each Band\")), /*#__PURE__*/React.createElement(Chart, {\n    options: chartConfig.options,\n    series: chartConfig.series,\n    type: \"bar\",\n    width: \"700\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 230,\n      columnNumber: 17\n    }\n  })) : null, JSON.stringify(chartConfig));\n};\n\nexport default LoansAndData;","map":{"version":3,"sources":["/Users/jonathantaylor/Google Drive/Interview2/Frontend/src/containers/LoansAndData.js"],"names":["React","useEffect","useState","useContext","axios","loanTypeContext","companyLoanContext","Company","InputAndError","SelectAndError","LoanRequest","styled","Redirect","useHistory","average","tags","loanAmounts","bandCounter2","loanBandCounter","frequencyAndTotal","Chart","StyledUl","ul","StyledChart","LoansAndData","props","companies","setCompanies","startFormData","name","amount","type","otherType","loanTypes","loanData","setLoanData","companyLoanDetails","setCompanyLoanDetails","inputValidated","setInputValidated","inputClicked","setInputClicked","data","setData","chartConfig","setChartConfig","history","getCompanies","response","get","response2","dataTypes","Object","keys","frequencyAndTotals","values","averages","map","frequency","totalAmount","typeFrequencies","frequencies","options","plotOptions","bar","distributed","legend","show","chart","id","xaxis","categories","labels","trim","maxHeight","series","addLoan","e","preventDefault","post","dropDownChangeHandler","value","target","onChangeHandler","showLoanDetails","companyId","clickedCompany","find","company","_id","push","deleteCompany","delete","updatedCompanies","filter","inputUsed","onBlurHandler","isFieldValid","validator","console","log","formValid","key","changeGraph","updatedConfig","companiesUI","loans","loan","optionElements","loanType","index","length","JSON","stringify"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport axios from 'axios';\nimport { loanTypeContext, companyLoanContext } from '../context';\nimport Company from '../components/company';\nimport InputAndError from '../components/inputAndError';\nimport SelectAndError from '../components/selectAndError';\nimport LoanRequest from '../components/loanInfo';\nimport styled from 'styled-components';\nimport { Redirect, useHistory } from 'react-router-dom';\nimport { average, tags, loanAmounts, bandCounter2, loanBandCounter, frequencyAndTotal } from '../calculationFunctions';\nimport Chart from \"react-apexcharts\";\n\nconst StyledUl = styled.ul`\ndisplay: flex;\nflex-direction: column;\nwidth: 400px;\nmargin-top: 5rem;\n`\n\nconst StyledChart = styled(Chart)`\nborder: black solid 1px;\nmargin: 4rem;\nwidth: 700px;\n`\n\nconst LoansAndData = (props) => {\n    const [companies, setCompanies] = useState([]); \n    const startFormData = {name: \"\", amount: \"\", type: \"DEFAULT\", otherType: \"\"};\n    const {loanTypes} = useContext(loanTypeContext);\n    const [loanData, setLoanData] = useState(startFormData);\n    const {companyLoanDetails, setCompanyLoanDetails} = useContext(companyLoanContext);\n    const [inputValidated, setInputValidated] = useState({name: false, amount: false, type: false, otherType: true})\n    const [inputClicked, setInputClicked] = useState({name: false, amount: false, type: false, otherType: false});\n    const [data, setData] = useState();\n\n    const [chartConfig, setChartConfig] = useState();\n\n\n\n    const history = useHistory();\n    \n\n\n    useEffect(()=> {\n        getCompanies();\n    }, [])\n\n    const getCompanies = async ()=>{\n        let response = await axios.get('http://localhost:5000/loans');\n        setCompanies(response.data.companies);\n        let response2 = frequencyAndTotal(loanTypes, response.data.companies);\n        let dataTypes = Object.keys(response2);\n        let frequencyAndTotals = Object.values(response2)\n        let averages = frequencyAndTotals.map(data=> data.frequency !== 0 ? data.totalAmount/data.frequency : 0);\n        let typeFrequencies = frequencyAndTotals.map(data=>data.frequency);\n        setData({averages: averages, frequencies: typeFrequencies});\n        setChartConfig({\n            options: {\n                plotOptions: {\n                    bar: {\n                        distributed: true\n                    }\n                  },\n                legend: {\n                    show: false\n                }, \n                chart: {\n                    id: \"basic-bar\"\n                },\n                xaxis: {\n                    categories: [dataTypes],\n                    labels: {trim:false, maxHeight: 180}\n                }\n            },\n            series: [\n              {\n                name: \"\",\n                data: [averages]\n              }\n            ]\n        })\n    }\n\n    \n\n    const addLoan = async (e)=>{\n        e.preventDefault();\n        let data = {name: loanData.name, amount: loanData.amount, type: loanData.type, otherType: loanData.otherType};\n        await axios.post('http://localhost:5000/loans', data);\n        setLoanData(startFormData);\n        getCompanies();        \n    }\n\n    const dropDownChangeHandler = (e)=>{\n        let {value} = e.target;\n        if(value===\"Other\"){\n            setLoanData({...loanData, type: value})\n            setInputValidated({...inputValidated, otherType: false})\n        }\n        else{\n            setLoanData({...loanData, type: value, otherType: \"\"});\n            setInputValidated({...inputValidated, otherType: true})\n        }\n    }\n\n    const onChangeHandler = (e)=>{\n        let {name, value} = e.target;\n        setLoanData({...loanData, [name]: value});\n    }\n\n    const showLoanDetails = (companyId)=>{\n        let clickedCompany = companies.find(company=> company._id===companyId);\n        setCompanyLoanDetails(clickedCompany);\n        history.push('/details');\n        \n    }\n    const deleteCompany = async (companyId)=>{\n        await axios.delete('http://localhost:5000/loans/' + companyId);\n        let updatedCompanies = [...companies].filter(company=>company._id!==companyId);\n        setCompanies(updatedCompanies);\n    }\n\n    const inputUsed = (name)=>{\n        if(inputClicked[name]===false){\n            setInputClicked({...inputClicked, [name]: true})\n        }\n    }\n\n    const onBlurHandler = (e)=>{\n        let {name, value} = e.target;\n        inputUsed(name);\n        isFieldValid(name, value);\n    }\n\n    const isFieldValid = (name, value)=>{\n        let validator = true;\n        if(value===\"\"){\n            validator = \"Please insert a value\";\n            setInputValidated({...inputValidated, [name]: validator});\n            return\n        }\n\n        switch(name) {\n\n        case \"type\":\n            if(value===\"DEFAULT\"){\n                validator = \"Please choose a type\"\n            }\n            break;\n\n        case \"amount\":\n            console.log(name);\n            if(value < 15000){\n                validator = \"Please insert an amount greater than £15000\"\n            }\n            else if(value%1000!==0){\n                validator = \"Please insert an amount that is a multiple of 1000\"  \n            }   \n            break;     \n    }\n    setInputValidated({...inputValidated, [name]: validator});\n}\n\nlet formValid = ()=>{\n    for (let key in inputValidated){\n        if(inputValidated[key]!==true){\n            return false;\n        }\n    }\n    return true;\n}\n\nconst changeGraph=(e)=>{\n    let updatedConfig = {...chartConfig};\n    switch (e.target.name){\n        case \"average\":\n            setChartConfig({...chartConfig, series: [{name: \"Average\", data: data.averages}]});\n            break;\n        case \"frequencyType\":\n            setChartConfig({...chartConfig, series: [{name: \"Frequency\", data: data.frequencies}]});\n            break;\n        default:\n            console.log(\"error\");       \n    }\n}\n\n\n  let companiesUI;\n    if(companies!==[]){\n        companiesUI = companies.map(company=>{\n            return <Company showLoanDetails={()=>showLoanDetails(company._id)} key={company._id} name = {company.name} deleteCompany={()=>deleteCompany(company._id)}>\n                {company.loans.map((loan)=> <LoanRequest amount={loan.amount} type={loan.type}/>)}\n            </Company>\n        })\n    }\n   \n    const optionElements = [<option key=\"-1\" value=\"DEFAULT\" disabled>Loan Type</option>, loanTypes.map((loanType, index)=><option key={index} value={loanType}>{loanType}</option>)];\n\n    console.log(chartConfig);\n    return(\n        <>\n        <form onSubmit={(e)=>addLoan(e)} >\n            <InputAndError id=\"nameInput\" label=\"Name\" name=\"name\" value={loanData.name} onChange={(e)=>onChangeHandler(e)} onBlur={(e)=>onBlurHandler(e)} errorMessage={inputValidated.name} inputClicked={inputClicked.name} inputValidated={inputValidated.name}/>\n            <InputAndError id=\"amountInput\" label=\"Amount\" name=\"amount\" value={loanData.amount} onChange={(e)=>onChangeHandler(e)} onBlur={(e)=>onBlurHandler(e)} errorMessage={inputValidated.amount} inputClicked={inputClicked.amount} inputValidated={inputValidated.amount}/>\n            <SelectAndError id=\"loanType\" label=\"Type\" onBlur={(e)=>onBlurHandler(e)} required name=\"type\" value={loanData.type} onChange={(e)=>dropDownChangeHandler(e)} errorMessage={inputValidated.type} inputClicked={inputClicked.type} inputValidated={inputValidated.type}>\n                {optionElements}\n            </SelectAndError>\n            {loanData.type===\"Other\" ? \n            <InputAndError id=\"otherType\" label=\"Other Type\" name=\"otherType\" value={loanData.otherType} onChange={(e)=>onChangeHandler(e)} onBlur={(e)=>onBlurHandler(e)} errorMessage={inputValidated.otherType} inputClicked={inputClicked.otherType} inputValidated={inputValidated.otherType}/>\n            : null}\n            <button disabled={!formValid()}>Add Loan Request</button>\n        </form>\n        <div>\n            <h1>Businesses</h1>\n            \n            {companies!==[] ?\n            <> \n            <p>Click Business to Show Further Details</p>\n            <StyledUl>{companiesUI}</StyledUl>\n            </>\n             : <p>Currently no businesses</p>}\n        </div>\n        {chartConfig.options.xaxis.categories.length!==0 ? \n            <div>\n                <div>\n                    <button name=\"average\" onClick={(e)=>changeGraph(e)}>Average of Each Loan Type</button>  \n                    <button name=\"frequencyType\" onClick={(e)=>changeGraph(e)}>Frequency of Each Loan Type</button>\n                    <button name=\"frequencyBands\">Frequency of Loans in Each Band</button>\n                </div>\n                <Chart\n                    options={chartConfig.options}\n                    series={chartConfig.series}\n                    type=\"bar\"\n                    width=\"700\"\n                    />\n            </div>\n        :null}\n        {JSON.stringify(chartConfig)}\n        </>\n    )\n}; \n\nexport default LoansAndData;"]},"metadata":{},"sourceType":"module"}